# План диагностики проблемы загрузки сайта

## Гипотезы о причинах проблемы

### Гипотеза A: Проблемы с загрузкой ресурсов (JS/CSS файлов)
**Описание:** JS и CSS файлы не загружаются или загружаются с неправильными заголовками через Cloudflare Proxy
**Индикаторы:**
- Ошибки загрузки ресурсов в логах
- Долгое время загрузки ресурсов
- Неправильные Content-Type заголовки

### Гипотеза B: Ошибки выполнения JavaScript кода
**Описание:** JS файлы загружаются, но содержат синтаксические ошибки или ошибки выполнения, которые блокируют инициализацию приложения
**Индикаторы:**
- Ошибки парсинга в логах
- Ошибки выполнения в main.tsx
- React не может отрендерить приложение

### Гипотеза C: Проблемы с загрузкой vendor chunks
**Описание:** Vendor чанки (react, recharts и т.д.) не загружаются параллельно или загружаются с ошибками
**Индикаторы:**
- Vendor чанки не загружаются
- Долгое время загрузки vendor чанков
- Ошибки импорта модулей

### Гипотеза D: Проблемы с инициализацией Telegram WebApp
**Описание:** Telegram WebApp скрипт не загружается или не инициализируется, блокируя загрузку приложения
**Индикаторы:**
- Telegram скрипт не загружается
- Таймаут инициализации Telegram
- window.Telegram не определен

### Гипотеза E: Проблемы с загрузкой данных из storage
**Описание:** Загрузка данных из localStorage/CloudStorage блокирует рендеринг приложения
**Индикаторы:**
- loadAllData не завершается
- Ошибки при загрузке данных
- Долгое время выполнения loadAllData

### Гипотеза F: Проблемы с таймаутами Cloudflare
**Описание:** Cloudflare обрывает соединение до завершения загрузки из-за таймаутов
**Индикаторы:**
- Соединение обрывается во время загрузки
- cf-cache-status: MISS в заголовках
- Долгое время ответа от сервера

### Гипотеза G: Проблемы с Content-Type заголовками
**Описание:** Браузер не распознает файлы правильно из-за неправильных Content-Type заголовков
**Индикаторы:**
- Неправильные MIME типы в ответах
- Браузер не парсит JS/CSS файлы
- Ошибки "non CSS MIME types" или "Unexpected token"

## Инструментация

Добавлено логирование в следующие места:
1. **index.html** - отслеживание загрузки HTML, Telegram скрипта, глобальных ошибок, загрузки ресурсов
2. **src/main.tsx** - отслеживание инициализации React, загрузки storage utils
3. **src/App.tsx** - отслеживание состояния компонента (isReady, loading, showSplash)
4. **src/hooks/useTelegram.ts** - отслеживание инициализации Telegram WebApp
5. **src/hooks/useCloudStorage.ts** - отслеживание загрузки данных из storage

Все логи отправляются на сервер и записываются в файл `.cursor/debug.log`

## Возможные решения

### Решение 1: Исправить redirect в Netlify
Если гипотеза A подтвердится:
- Проверить, что redirect не перехватывает статические файлы
- Убедиться, что заголовки для статических файлов правильные
- Добавить исключения для /assets/* в redirect

### Решение 2: Исправить ошибки в коде
Если гипотеза B подтвердится:
- Найти и исправить синтаксические ошибки
- Исправить ошибки выполнения
- Добавить обработку ошибок

### Решение 3: Оптимизировать загрузку vendor chunks
Если гипотеза C подтвердится:
- Настроить правильный порядок загрузки чанков
- Добавить preload для критических чанков
- Убедиться, что чанки загружаются параллельно

### Решение 4: Исправить загрузку Telegram WebApp
Если гипотеза D подтвердится:
- Добавить fallback для случая, когда Telegram не загружается
- Увеличить таймаут инициализации
- Использовать локальную копию скрипта

### Решение 5: Оптимизировать загрузку данных
Если гипотеза E подтвердится:
- Добавить lazy loading для данных
- Оптимизировать запросы к storage
- Добавить кеширование

### Решение 6: Настроить таймауты Cloudflare
Если гипотеза F подтвердится:
- Увеличить таймауты в Cloudflare
- Оптимизировать размер файлов
- Использовать CDN для статических файлов

### Решение 7: Исправить Content-Type заголовки
Если гипотеза G подтвердится:
- Убедиться, что все заголовки правильные
- Проверить настройки Netlify
- Добавить явные заголовки для всех типов файлов

