<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <title>Test Telegram Mini App - Clarity</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #ffffff;
    }
    #test-info {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #f0f0f0;
      padding: 10px;
      border-bottom: 1px solid #ddd;
      font-size: 12px;
      z-index: 10000;
    }
    iframe {
      width: 100%;
      height: 100vh;
      border: none;
      margin-top: 40px;
    }
  </style>
  <!-- Имитация Telegram WebApp API -->
  <script>
    // Создаем мок Telegram WebApp API
    window.Telegram = {
      WebApp: {
        ready: function() {
          console.log('Telegram WebApp ready() called');
        },
        expand: function() {
          console.log('Telegram WebApp expand() called');
        },
        close: function() {
          console.log('Telegram WebApp close() called');
        },
        setHeaderColor: function(color) {
          console.log('Telegram WebApp setHeaderColor() called with:', color);
        },
        viewportHeight: window.innerHeight,
        viewportStableHeight: window.innerHeight,
        isExpanded: true,
        BackButton: {
          show: function() {
            console.log('BackButton show() called');
          },
          hide: function() {
            console.log('BackButton hide() called');
          },
          onClick: function(callback) {
            console.log('BackButton onClick() registered');
          },
          offClick: function(callback) {
            console.log('BackButton offClick() called');
          },
          isVisible: false
        },
        CloudStorage: {
          getItem: function(key, callback) {
            console.log('CloudStorage getItem() called with key:', key);
            const value = localStorage.getItem(key);
            setTimeout(() => callback(null, value), 100);
          },
          setItem: function(key, value, callback) {
            console.log('CloudStorage setItem() called with key:', key);
            localStorage.setItem(key, value);
            setTimeout(() => callback(null), 100);
          }
        },
        openLink: function(url, options) {
          console.log('openLink() called with:', url, options);
          window.open(url, '_blank');
        },
        showAlert: function(message) {
          console.log('showAlert() called with:', message);
          alert(message);
        },
        showConfirm: function(message, callback) {
          console.log('showConfirm() called with:', message);
          const result = confirm(message);
          if (callback) callback(result);
        },
        disableVerticalSwipes: function() {
          console.log('disableVerticalSwipes() called');
        },
        enableClosingConfirmation: function() {
          console.log('enableClosingConfirmation() called');
        },
        initDataUnsafe: {
          user: {
            id: 123456789,
            first_name: 'Test',
            last_name: 'User',
            username: 'testuser',
            language_code: 'ru',
            is_premium: false,
            photo_url: ''
          }
        },
        version: '6.0',
        platform: 'web',
        colorScheme: 'light',
        themeParams: {
          bg_color: '#ffffff',
          text_color: '#000000',
          hint_color: '#999999',
          link_color: '#2481cc',
          button_color: '#2481cc',
          button_text_color: '#ffffff',
          secondary_bg_color: '#f1f1f1',
          header_bg_color: '#ffffff',
          accent_text_color: '#2481cc',
          section_bg_color: '#ffffff',
          section_header_text_color: '#000000',
          subtitle_text_color: '#999999',
          destructive_text_color: '#ff0000'
        }
      }
    };

    // Логируем все вызовы для отладки
    const originalSetHeaderColor = window.Telegram.WebApp.setHeaderColor;
    window.Telegram.WebApp.setHeaderColor = function(color) {
      console.log('✓ setHeaderColor called with:', color);
      originalSetHeaderColor.call(this, color);
    };

    // Проверяем загрузку
    window.addEventListener('load', function() {
      const info = document.getElementById('test-info');
      if (window.Telegram && window.Telegram.WebApp) {
        info.innerHTML = '✓ Telegram WebApp API мок создан успешно. Приложение должно загрузиться.';
        info.style.background = '#d4edda';
        info.style.color = '#155724';
      } else {
        info.innerHTML = '✗ Ошибка: Telegram WebApp API не найден';
        info.style.background = '#f8d7da';
        info.style.color = '#721c24';
      }
    });

    // Обработка ошибок
    window.addEventListener('error', function(e) {
      const info = document.getElementById('test-info');
      info.innerHTML = '✗ Ошибка загрузки: ' + e.message + ' в ' + e.filename + ':' + e.lineno;
      info.style.background = '#f8d7da';
      info.style.color = '#721c24';
      console.error('Error:', e);
    });
  </script>
</head>
<body>
  <div id="test-info">Загрузка тестового окружения...</div>
  <iframe src="http://localhost:3000" id="app-frame"></iframe>
  <script>
    // Проверяем доступность сервера
    const iframe = document.getElementById('app-frame');
    iframe.onload = function() {
      console.log('✓ Iframe загружен успешно');
    };
    iframe.onerror = function() {
      const info = document.getElementById('test-info');
      info.innerHTML = '✗ Ошибка: Не удалось загрузить приложение. Убедитесь, что dev-сервер запущен (npm run dev)';
      info.style.background = '#f8d7da';
      info.style.color = '#721c24';
    };
  </script>
</body>
</html>

