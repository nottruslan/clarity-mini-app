<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <title>Clarity</title>
  <script>
    // #region agent log
    (function() {
      const logEndpoint = 'http://127.0.0.1:7250/ingest/ee1f61b1-2553-4bd0-a919-0157b6f4b1e5';
      const log = (msg, data, hypothesisId) => {
        fetch(logEndpoint, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'index.html',message:msg,data:data||{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:hypothesisId||'A'})}).catch(()=>{});
      };
      log('HTML loaded', {url: window.location.href, userAgent: navigator.userAgent}, 'A');
      
      // Отслеживаем загрузку Telegram скрипта
      const telegramScript = document.createElement('script');
      telegramScript.src = 'https://telegram.org/js/telegram-web-app.js';
      telegramScript.defer = true;
      const telegramLoadStart = Date.now();
      telegramScript.onload = () => {
        log('Telegram script loaded', {loadTime: Date.now() - telegramLoadStart, hasTelegram: !!window.Telegram}, 'D');
      };
      telegramScript.onerror = (err) => {
        log('Telegram script error', {error: err.toString(), loadTime: Date.now() - telegramLoadStart}, 'D');
        window.Telegram = window.Telegram || {};
      };
      document.head.appendChild(telegramScript);
      
      // Отслеживаем загрузку основного модуля
      window.addEventListener('error', (e) => {
        log('Global error', {message: e.message, filename: e.filename, lineno: e.lineno, colno: e.colno, error: e.error?.toString()}, 'B');
      }, true);
      
      // Отслеживаем загрузку ресурсов
      const resourceObserver = new PerformanceObserver((list) => {
        list.getEntries().forEach(entry => {
          if (entry.initiatorType === 'script' || entry.initiatorType === 'link') {
            log('Resource loaded', {
              name: entry.name,
              type: entry.initiatorType,
              duration: entry.duration,
              size: entry.transferSize,
              status: entry.responseStatus
            }, 'A');
          }
        });
      });
      try {
        resourceObserver.observe({entryTypes: ['resource']});
      } catch(e) {}
    })();
    // #endregion
  </script>
  <script src="https://telegram.org/js/telegram-web-app.js" defer onerror="console.warn('Failed to load Telegram WebApp script'); window.Telegram = window.Telegram || {};"></script>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>
</html>

